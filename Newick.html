<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Newick Format
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="BioFSharp aims to be a user-friendly library for Bioinformatics written in F# as the successor official of FSharpBio."/>
    <meta name="author" content="Timo MÃ¼hlhaus"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>
    <link type="text/css" rel="stylesheet" href="/BioFSharp/style/CSBstyle.css" />
    <link type="text/css" rel="stylesheet" href="/BioFSharp/content/style.css" />
    <script type="text/javascript" src="/BioFSharp/content/tips.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/CSBiology/BioFSharp">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/BioFSharp/index.html">BioFSharp</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Newick-Format" class="anchor" href="#Newick-Format">Newick Format</a></h1>
<a id="SourceCode" href="https://github.com/CSBiology/BioFSharp/blob/master/src/BioFSharp.IO/Newick.fs">&lt;/&gt;view source code</a>
<a id="APILink" href="https://csbiology.github.io/BioFSharp/reference/biofsharp-io-newick.html" >&#128194;View module documentation</a>
<a id="Author" href="https://github.com/HLWeil">&#128366;view author of this tutorial</a>
<br><br>
<p>The newick format is a simple, strictly symbolised format representing phylogenetic trees. It is the standard tree format used by the Clustal tool.<br />
In general, internal nodes (nodes with a least one descendant) are opened with <code>(</code> and closed with <code>)</code>. The childnodes within those internals are separated by <code>,</code>. After every node, there can be, but most not be information about its name and the distance from its parent. Name and distance are separated by <code>:</code>. Every full tree has a <code>;</code> at its end.<br />
These key characters are not allowed to be used within the given names or distances. This restriction allows a wide range of possible trees as can be seen by the following list of example trees:</p>
<br>
<button type="button" class="btn" data-toggle="collapse" data-target="#newickExample">Show/Hide example trees</button>
<div id="newickExample" class="collapse treeExamples ">
( taken from wikipedia )  
<ul>
<li>
<p>(,,(,));</p>
<p>no nodes are named</p>
</li>
<li>
<p>(A,B,(C,D));</p>
<p>leaf nodes are named</p>
</li>
<li>
<p>(A,B,(C,D)E)F;</p>
<p>all nodes are named</p>
</li>
<li>
<p>(:0.1,:0.2,(:0.3,:0.4):0.5);</p>
<p>all but root node have a distance to parent</p>
</li>
<li>
<p>(:0.1,:0.2,(:0.3,:0.4):0.5):0.0;</p>
<p>all have a distance to parent</p>
</li>
<li>
<p>(A:0.1,B:0.2,(C:0.3,D:0.4):0.5);</p>
<p>distances and leaf names (popular)</p>
</li>
<li>
<p>(A:0.1,B:0.2,(C:0.3,D:0.4)E:0.5)F;</p>
<p>distances and all names</p>
</li>
<li>
<p>((B:0.2,(C:0.3,D:0.4)E:0.5)F:0.1)A;</p>
<p>a tree rooted on a leaf node (rare)</p>
</li>
</ul>
<button type="button" class="btn" data-toggle="collapse" data-target="#newickExample">Hide again</button>  
</div>
<br>
<p>The parser integrated in BioFSharp tries to cover this wide range of possible input data by using a very generic tree representantion and allowing the user to parse it the way he wants by the usage of a mapping function as additional input. Of course having an idea about this tree implementation is necessary for working with the already parsed trees. It is therefore recommended to look into the <code>PhylTree</code>(API reference can be found <a href="reference/biofsharp-phyltree.html">here</a>).</p>
<h2><a name="Reading-Newick-Files" class="anchor" href="#Reading-Newick-Files">Reading Newick Files</a></h2>
<p>To read a newick file, the function <code>ofFile</code> in <code>BioFSharp.IO.Newick</code> has to be used. It takes a mapping function of type <code>string -&gt; 'Distance</code> and a path of type <code>string</code>. This means that names are always parsed as string but distances can be parsed at will. The usage of this is demonstrated here:</p>
<p>Let's say we want to parse the following tree (which is btw. output generated by clustal omega):</p>
<p>(<br />
(<br />
Mozarella:0.44256,<br />
Brie:-0.01399)<br />
:0.01161,<br />
Cheddar:-0.00714,<br />
(<br />
Emmentaler:0.00113,<br />
Gouda:-0.00113)<br />
:0.00714);</p>
<p>After wrapping ones head about this symbol salad, one might find a few things about this tree:<br />
-Only the leaf nodes are named<br />
-Every node but the top node has a distance in form of a float number<br />
-All subtrees are binary<br />
<br>
Here is the same tree in the form of a cladogramm:<br />
<img src="img/Tree.png" alt="tree1" /><br />
<br>
Now comes the parsing, as already mentioned, to bring the distance into a better form, we have to define a mapping function. In this case it's easy: we basically only need a function that transforms a string to a float <em>if possible</em>. Here it's important to mention that the parser interprets all nodes in the same way, as a functional programmer might expect. As not all nodes in the above tree have distances, that case has to be covered too, which is done in two different ways in this example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">BioFSharp</span><span class="o">.</span><span class="i">IO</span>

<span class="k">let</span> <span class="i">fileDir</span> <span class="o">=</span> <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;/data/&quot;</span>


<span class="c">//Maps string to float if possible. In the case it&#39;s not it just returns 0 instead</span>
<span class="k">let</span> <span class="i">floatMapping</span> (<span class="i">distance</span><span class="o">:</span> <span class="i">string</span>) <span class="o">=</span>
    <span class="k">try</span> (<span class="i">float</span> <span class="i">distance</span>) <span class="k">with</span> | _ <span class="k">-&gt;</span> <span class="n">0.</span>

<span class="c">//Maps string to optional float wether it can be converted or not.</span>
<span class="k">let</span> <span class="i">floatMappingOptional</span> (<span class="i">distance</span><span class="o">:</span> <span class="i">string</span>) <span class="o">=</span>
    <span class="k">match</span> <span class="i">System</span><span class="o">.</span><span class="i">Double</span><span class="o">.</span><span class="i">TryParse</span> <span class="i">distance</span> <span class="k">with</span>
    | <span class="k">true</span>, <span class="i">v</span>    <span class="k">-&gt;</span> <span class="i">Some</span> <span class="i">v</span>
    | <span class="k">false</span>, _   <span class="k">-&gt;</span> <span class="i">None</span>

<span class="c">//As path we set an examplefile included in biofsharp which consists of the tree shown above</span>
<span class="k">let</span> <span class="i">path</span> <span class="o">=</span> <span class="i">fileDir</span> <span class="o">+</span> <span class="s">&quot;treeExample.txt&quot;</span>

<span class="i">Newick</span><span class="o">.</span><span class="i">ofFile</span> <span class="i">floatMapping</span> <span class="i">path</span>
</code></pre></td>
</tr>
</table>
<p>The function returns the following result:<br />
<pre>
val it : BioFSharp.PhylTree.Node<float * string> =
Branch
(("", 0.0),
[Branch
(("", 0.01161),
[Branch (("Mozarella", 0.44256),[]); Branch (("Brie", -0.01399),[])]);
Branch (("Cheddar", -0.00714),[]);
Branch
(("", 0.00714),
[Branch (("Emmentaler", 0.00113),[]); Branch (("Gouda", -0.00113),[])])])</p>
</pre>
<p>As written above, having an idea about the <code>PhylTree</code> in BioFSharp makes understanding this result much easier. Its API reference can be found <a href="reference/biofsharp-phyltree.html">here</a>.</p>
<h2><a name="Writing-Newick-Files" class="anchor" href="#Writing-Newick-Files">Writing Newick Files</a></h2>
<p>To write a Newick file, the function <code>toFile</code> is used. Besides the output path and the tree it takes two additional functions. <code>nodeConverter</code> is intended to be used as a kind of separator of node name and distance, as sometimes the node info is not stored as a simple tuple, but has to be parsed as such. Both have to be converted to strings for parsing reasons.</p>
<p>Let's see this in action. As an example we want to rebuild the original treeFile we read out above. Keep one thing in mind though: Of course we want to have it exactly look like the original. If you have read the tree with the converter function which returns a zero if the distance is not mappable to float, then the conversion back to string has to cover this case, or this zero will end up being in the file. This is not really a safe approach though, as real zeros might be lost with it. Therefore we will read and write the distance as an option and use the floatConverterOptional defined above:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">//Tree with distancevalue wrapped as option</span>
<span class="k">let</span> <span class="i">myOptionalTree</span> <span class="o">=</span> <span class="i">Newick</span><span class="o">.</span><span class="i">ofFile</span> <span class="i">floatMappingOptional</span> <span class="i">path</span>

<span class="c">//convertes nodeinformation to writeable name and distance</span>
<span class="k">let</span> <span class="i">converter</span> (<span class="i">n</span>,<span class="i">d</span>) <span class="o">=</span> 
    <span class="i">n</span>,
    <span class="k">match</span> <span class="i">d</span> <span class="k">with</span>
    | <span class="i">Some</span> <span class="i">fl</span>   <span class="k">-&gt;</span> <span class="i">string</span> <span class="i">fl</span>
    | <span class="i">None</span>      <span class="k">-&gt;</span> <span class="s">&quot;&quot;</span> 

<span class="c">//write our original tree to path</span>
<span class="i">Newick</span><span class="o">.</span><span class="i">toFile</span> <span class="i">converter</span> (<span class="i">fileDir</span> <span class="o">+</span> <span class="s">&quot;outputTree.txt&quot;</span>) <span class="i">myOptionalTree</span>
</code></pre></td>
</tr>
</table>


        </div>
        <div class="span3" >
          <img src="/BioFSharp/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
            <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
                <li class="nav-header">BioFSharp</li>
                <li><a href="/BioFSharp/index.html">Home page</a></li>
                <li class="divider"></li>
                <li><a href="/BioFSharp/Introduction.html">Getting started</a></li>

                
                <li class="nav-header">BioFSharp core</li>
                <li><a href="/BioFSharp/Formula.html">Formula</a></li>
                <li>
                    <a href="/BioFSharp/BioItem.html">BioItems</a>
                </li>
                <li>
                    <a href="/BioFSharp/BioCollections.html">BioCollections</a>
                </li>
                <li><a href="/BioFSharp/AminoProperties.html">Peptide Properties</a></li>
                <li class="nav-header">Algorithm</li>
                <li><a href="/BioFSharp/Alignment.html">Alignment</a></li>
                <li><a href="/BioFSharp/MotiveSearch.html">Motive search</a></li>
                <li><a href="/BioFSharp/BlastWrapper.html">NCBI-Blast</a></li>
                <li>
                    <a href="/BioFSharp/StringMatching.html">Pattern Queries</a>
                </li>
                <li class="nav-header">File I/O</li>
                <li><a href="/BioFSharp/FastA.html">FastA</a></li>
                <li><a href="/BioFSharp/FastQ.html">FastQ</a></li>
                <li><a href="/BioFSharp/GFF3.html">GFF format</a></li>
                <li><a href="/BioFSharp/GenBank.html">GenBank</a></li>
                <li>
                    <a href="/BioFSharp/Clustal.html">Clustal</a>
                </li>        
                <li>
                    <a href="/BioFSharp/Newick.html">Newick</a>
                    <ul class="nav nav-list">
                        <li><a href="/BioFSharp/Newick.html#Newick-Format">Format</a></li>
                        <li><a href="/BioFSharp/Newick.html#Reading-Newick-Files">Reading</a></li>
                        <li><a href="/BioFSharp/Newick.html#Writing-Newick-Files">Writing</a></li>
                    </ul>
                </li>                
                <li><a href="/BioFSharp/Obo.html">Obo ontology format</a></li>
                <li><a href="/BioFSharp/CSV.html">Delimited files</a></li>
                <li class="nav-header">Web I/O</li>
                <li><a href="/BioFSharp/UniProt.html">UniProt</a></li>
                <li><a href="/BioFSharp/BioDB.html">BioDB</a></li>
                <li class="nav-header">Biostatistics</li>
                <li><a href="/BioFSharp/GESA.html">Ontology enrichment</a></li>
                <li class="nav-header">Biovisualization</li>
                <li><a href="/BioFSharp/WebLogo.html">Web logo</a></li>
                
                <li class="nav-header">Documentation</li>
                <li><a href="/BioFSharp/reference/index.html">API Reference</a></li>


                
            </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/CSBiology/BioFSharp"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
